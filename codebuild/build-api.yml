version: 0.2

# variables to use during the build
env:
  variables:
    AWS_REGION: "eu-west-1"

phases:
  install:
    commands:
      - echo "install stage"
  pre_build:
      - IMAGE_TAG="$CODEBUILD_BUILD_NUMBER-$(echo "CODEBUILD_RESOLVED_SOURCE_VERSION" | cut -c 1-7)"
  build:
    commands:
      - docker compose build api
  post_build:
    commands:
      - docker images
artifacts:
  files:
    - api/**/*
    - codebuild/**/*
    - infrastructure/**/*
    - docker-compose.yml